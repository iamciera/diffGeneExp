WT
----

Marginal Blastozone vs Other, B region (middle) attempt 1
=========================================================

```{r}
library(edgeR)
```

###Read in Data
Read in raw count data per gene.
Add checknames to FALSE because it was making the columns unique. 

```{r}
counts <- read.delim("sam2countsResults.tsv",check.names=FALSE,row.names=1)

#check the file
head(counts)
summary(counts)
colnames(counts)
#need to convert NA to 0 counts
counts[is.na(counts)] <- 0
```

###Subset per DE expirement

I am going to start by subsetting the particular treatments I am looking at.

```{r}
colnames(counts)
wtbregion <- counts[,32:39]
head(wtbregion)
colnames(wtbregion)
```

```{r}
group <- c(rep("wtbmbr", 4), rep("wtbother", 4))
d <- DGEList(counts=wtbregion,group=group)
```
There are two libraries that are super small, what is going on here? Should I drop them from analaysis?
```{r}
d$samples
```

```{r}
d <- d[rowSums(cpm.d>2)>=3,] 
d <- estimateCommonDisp(d,verbose=T) #This gave error. 
cpm.d <- cpm(d)
d <- calcNormFactors(d)
d <- estimateCommonDisp(d)
DEtest <- exactTest(d,pair=c("wtbmbr","wtbother"))
head(DEtest$table)
results <- topTags(DEtest)
head(results$table,n=30) #again only 10 listed.  This looks identical to the last one. Something is wrong.
sum(results$table$PValue<.01)
summary(decideTestsDGE(DEtest,p.value=.01))
sig.genes <- rownames(results$table[results$table$PValue<0.01,])
plotSmear(d,de.tags=sig.genes)
```

What are the genes that are misexpressed?
For this we need to add some annotation

```{r}
annotation1<- read.delim("ITAG2.3_all_Arabidopsis_ITAG_annotations.tsv", header=FALSE)  #Changed to the SGN human readable annotation
colnames(annotation1)<- c("ITAG", "SGN_annotation")
annotation2<- read.delim ("ITAG2.3_all_Arabidopsis_annotated.tsv")
annotation <- merge (annotation1,annotation2, by =1,1, all.x=TRUE)
head(annotation) 
#head(results) This returns "Error: Two subscripts required"
results.annotated <- merge(results$table,annotation,by.x="row.names",by.y="ITAG",all.x=T,sort=F)
head(results.annotated,n=30)
```

Write table with results
```{r}
write.table(results.annotated,"wtbmbr_wtbother_DE1.attempt1.tsv",sep="\t",row.names=F)
```

There are appear to be many problems.  The smear plot looks weird. I need to re-run without those small libraries. 


####WT
###Marginal Blastozone vs Other, B region (middle) attempt 2

Subset
```{r}
colnames(counts)
wtbmbr <- counts[,32:34]
wtbother <- counts[37:39]
wtbregion <- cbind(wtbmbr, wtbother)
head(wtbregion)
colnames(wtbregion)
```

```{r}
group <- c(rep("wtbmbr", 3), rep("wtbother", 3))
d <- DGEList(counts=wtbregion,group=group)
```

```{r}
d$samples
```
There are several warnings when running this, look into.
```{r}
d <- d[rowSums(cpm.d>2)>=3,] 
d <- estimateCommonDisp(d,verbose=T) 
cpm.d <- cpm(d)
d <- calcNormFactors(d)
d <- estimateCommonDisp(d)
DEtest <- exactTest(d,pair=c("wtbmbr","wtbother"))
head(DEtest$table)
results <- topTags(DEtest)
head(results$table,n=30) #again only 10 listed.  This looks identical to the last one. Something is wrong.
sum(results$table$PValue<.01)
summary(decideTestsDGE(DEtest,adjust.method="BH",p.value=.01))  
sig.genes <- rownames(results$table[results$table$PValue<0.01,])
plotSmear(d,de.tags=sig.genes)
```

```{r}
annotation1<- read.delim("ITAG2.3_all_Arabidopsis_ITAG_annotations.tsv", header=FALSE)  #Changed to the SGN human readable annotation
colnames(annotation1)<- c("ITAG", "SGN_annotation")
annotation2<- read.delim ("ITAG2.3_all_Arabidopsis_annotated.tsv")
annotation <- merge (annotation1,annotation2, by =1,1, all.x=TRUE)
head(annotation) 
#head(results) This returns "Error: Two subscripts required"
results.annotated <- merge(results$table,annotation,by.x="row.names",by.y="ITAG",all.x=T,sort=F)
head(results.annotated,n=30)
```

Write table with results
```{r}
write.table(results.annotated,"wtbmbr_wtbother_DE1.attempt2.tsv",sep="\t",row.names=F)
```

There are appear to be many problems.  Something is going on here. 

####WT
###Marginal Blastozone vs Other, B region (middle) attempt 1

Subset
```{r}
colnames(counts)
wtbregion <- counts[,32:39]
head(wtbregion)
colnames(wtbregion)
```

```{r}
group <- c(rep("wtbmbr", 4), rep("wtbother", 4))
d <- DGEList(counts=wtbregion,group=group)
```
There are two libraries that are super small, what is going on here? Should I drop them from analaysis?
```{r}
d$samples
```
There are no warnings anymore at least. 
```{r}
d <- d[rowSums(cpm.d>2)>=3,] 
d <- estimateCommonDisp(d,verbose=T) #This gave error. 
cpm.d <- cpm(d)
d <- calcNormFactors(d)
d <- estimateCommonDisp(d)
DEtest <- exactTest(d,pair=c("wtbmbr","wtbother"))
head(DEtest$table)
results <- topTags(DEtest)
head(results$table,n=30) #again only 10 listed.  This looks identical to the last one. Something is wrong.
sum(results$table$PValue<.01)
summary(decideTestsDGE(DEtest,p.value=.01))
sig.genes <- rownames(results$table[results$table$PValue<0.01,])
plotSmear(d,de.tags=sig.genes)
```

```{r}
annotation1<- read.delim("ITAG2.3_all_Arabidopsis_ITAG_annotations.tsv", header=FALSE)  #Changed to the SGN human readable annotation
colnames(annotation1)<- c("ITAG", "SGN_annotation")
annotation2<- read.delim ("ITAG2.3_all_Arabidopsis_annotated.tsv")
annotation <- merge (annotation1,annotation2, by =1,1, all.x=TRUE)
head(annotation) 
#head(results) This returns "Error: Two subscripts required"
results.annotated <- merge(results$table,annotation,by.x="row.names",by.y="ITAG",all.x=T,sort=F)
head(results.annotated,n=30)
```

Write table with results
```{r}
write.table(results.annotated,"wtbmbr_wtbother_DE1.attempt1.tsv",sep="\t",row.names=F)
```

There are appear to be many problems.  The smear plot looks weird. I need to re-run without those small libraries. 


####WT
###Marginal Blastozone vs Other, A region (tip) 

Subset
```{r}
colnames(counts)
wtaregion <- counts[,24:31]
head(wtaregion)
colnames(wtaregion)
```

```{r}
group <- c(rep("wtambr", 3), rep("wtaother", 5))
d <- DGEList(counts=wtaregion,group=group)
```

```{r}
d$samples
```

```{r}
d <- d[rowSums(cpm.d>2)>=3,] 
d <- estimateCommonDisp(d,verbose=T) 
cpm.d <- cpm(d)
d <- calcNormFactors(d)
d <- estimateCommonDisp(d)
DEtest <- exactTest(d,pair=c("wtambr","wtaother"))
head(DEtest$table)
results <- topTags(DEtest, n = 60)
head(results$table,n=30) #again only 10 listed.  This looks identical to the last one. Something is wrong.
sum(results$table$PValue<.01)
summary(decideTestsDGE(DEtest,adjust.method="BH",p.value=.01))  
sig.genes <- rownames(results$table[results$table$PValue<0.01,]) 
plotSmear(d,de.tags=sig.genes)
```

```{r}
annotation1<- read.delim("ITAG2.3_all_Arabidopsis_ITAG_annotations.tsv", header=FALSE)  #Changed to the SGN human readable annotation
colnames(annotation1)<- c("ITAG", "SGN_annotation")
annotation2<- read.delim ("ITAG2.3_all_Arabidopsis_annotated.tsv")
annotation <- merge (annotation1,annotation2, by =1,1, all.x=TRUE)
head(annotation) 
#head(results) This returns "Error: Two subscripts required"
results.annotated <- merge(results$table,annotation,by.x="row.names",by.y="ITAG",all.x=T,sort=F)
head(results.annotated,n=30)
```

Write table with results
```{r}
write.table(results.annotated,"wtbmbr_wtbother_DE1.attempt2.tsv",sep="\t",row.names=F)
```

There are appear to be many problems.  Something is going on here. 



library(rmarkdown)
render("edgeR_DE.Rmd", "pdf_document")

